import{j as e,r as t,R as v,G as w,h as S,A as R,B as N}from"./index-BQgG9jyf.js";const A="_Haccp_1sw3m_3",P="_haccp_inner_container_1sw3m_7",k="_haccp_page_title_1sw3m_17",E="_search_container_1sw3m_35",L="_search_input_1sw3m_45",F="_search_btn_1sw3m_58",I="_message_1sw3m_75",D="_content_container_1sw3m_93",M="_appear_1sw3m_1",$="_spinner_1sw3m_148",B="_message_container_1sw3m_156",G="_modal_1sw3m_203",O="_modal_title_1sw3m_239",T="_modal_content_con_1sw3m_245",r={Haccp:A,haccp_inner_container:P,haccp_page_title:k,search_container:E,search_input:L,search_btn:F,message:I,content_container:D,appear:M,spinner:$,message_container:B,modal:G,modal_title:O,modal_content_con:T},V="_layout_mo4no_1",W={layout:V},X=({setModal:s,modal:n})=>e.jsx("div",{style:n?{visibility:"visible",opacity:1}:{visibility:"hidden",opacity:0},className:W.layout,onClick:()=>{s(!1)}});function K({filterItem:s}){return e.jsx("section",{children:e.jsxs("div",{className:r.modal_content_con,children:[e.jsx("figure",{className:r.modal_figure,children:e.jsx("img",{src:`${s.imgurl1}`,alt:"상품이미지"})}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"상품명"}),e.jsx("br",{}),e.jsx("span",{children:s.prdlstNm??"알수없음"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"제조사"}),e.jsx("br",{}),e.jsx("span",{children:s.manufacture??"알수없음"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"성분"}),e.jsx("br",{}),e.jsx("span",{children:s.rawmtrl??"알수없음"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"알러지"}),e.jsx("br",{}),e.jsx("span",{children:s.allergy??"알수없음"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"바코드"}),e.jsx("br",{}),e.jsx("span",{children:s.barcode??"알수없음"})]})]})]},s.prdlstReportNo)})}function U({filterItem:s,setModal:n,modal:c}){return s?e.jsxs(e.Fragment,{children:[e.jsxs("article",{className:r.modal,style:c?{visibility:"visible",opacity:1}:{visibility:"hidden",opacity:0,scale:"0.5 0.5",transformOrigin:"left top"},children:[e.jsx("h2",{className:r.modal_title,children:"상품상세"}),e.jsx("button",{onClick:()=>{n(!1)},children:"X"}),e.jsx(K,{filterItem:s})]}),e.jsx(X,{setModal:n,modal:c})]}):e.jsx(e.Fragment,{})}function Q({currentPage:s,totalPage:n}){const[c,i]=t.useState(!0);return e.jsxs("aside",{className:r.message_container,style:c?{maxWidth:"240px",maxHeight:"40px"}:{maxWidth:"30px",maxHeight:"40px"},children:[e.jsx("button",{style:c?{transform:"rotate(-180deg)"}:{transform:"rotate(0)"},onClick:()=>{i(a=>a=!a)},children:"←"}),e.jsxs("span",{className:r.message,style:c?{visibility:"visible",opacity:1,transform:"translateX(0)"}:{visibility:"hidden",opacity:0,transform:"translateX(5px)"},children:[n||0,"개 중 ",s," 포스트 조회.."]})]})}function q({products:s,onClickOpenModal:n}){return e.jsx(e.Fragment,{children:s.map(c=>e.jsx("figure",{onClick:()=>{const i=c.item.prdlstReportNo;n(i)},children:e.jsxs("div",{id:"item_box",role:"listitem",children:[e.jsx("img",{src:`${c.item.imgurl1}`,alt:"상품이미지"}),e.jsx("p",{children:c.item.prdlstNm})]})},c.item.prdlstReportNo))})}function J({items:s,setModal:n,setProductId:c}){const i=t.useRef(null),a=Array.isArray(s)?s.length:0,[o,f]=t.useState([]);function g(l){n(!0),c(l)}return t.useEffect(()=>{if(s){const l=Number(sessionStorage.getItem("currentHccp"))||10,u=s.slice(0,l);f(u)}},[s]),t.useEffect(()=>{function l(){var u;if(s&&o.length>0&&((u=i.current)==null?void 0:u.getBoundingClientRect().bottom)<window.innerHeight+100){const d=o.length,m=s==null?void 0:s.slice(d,d+10);m&&m.length>0&&f(j=>[...j,...m]),sessionStorage.setItem("currentHccp",`${o.length}`)}}return window.addEventListener("scroll",l),()=>{window.removeEventListener("scroll",l)}},[o]),e.jsxs("section",{className:r.content_container,ref:i,children:[e.jsx(Q,{currentPage:o.length,totalPage:a}),e.jsx(q,{products:o,onClickOpenModal:g})]})}function Y(s){t.useEffect(()=>{s.current&&s.current.focus()},[])}const z=t.forwardRef((s,n)=>e.jsx("input",{ref:n,className:r.search_input,type:"search",value:void 0,id:r.search,name:"search-input",placeholder:"ex) 치킨"}));function Z({onClickSearch:s}){return e.jsx("button",{type:"button",className:r.search_btn,onClick:s,children:"조회"})}function ee({search:s,loading:n,productName:c,searchAction:i}){const a=t.useRef(null);function o(){s()}return Y(a),t.useEffect(()=>{a.current&&(a.current.value=c)},[c]),e.jsxs("form",{className:r.search_container,onSubmit:i,children:[e.jsx(z,{}),e.jsx(Z,{onClickSearch:o}),e.jsx("div",{className:r.spinner,style:n?{display:"block"}:{display:"none"},children:e.jsx(v,{})})]})}function se(){return e.jsxs("p",{className:r.message,children:[" ",e.jsx("span",{children:"잠깐 알고가기"})," ",e.jsx("br",{}),"해썹(HACCP) 제도는 식품, 축산물, 사료 등을 만드는 과정에서 생물학적, 화학적, 물리적 위해요인들이 발생할 수 있는 상황을 과학적으로 분석하고 사전에 위해요인의 발생여건들을 차단하여 소비자에게 안전하고 깨끗한 제품을 공급하기 위한 시스템적인 규정을 말합니다."]})}function ne(){const[s,n]=t.useState(""),[c,i]=t.useState(!1),[a,o]=t.useState(),[f,g]=t.useState(),[l,u]=t.useState(!1),[d,m]=t.useState(""),j=t.useRef(null),C=async h=>{i(!0);const p=`https://apis.data.go.kr/B553748/CertImgListServiceV2/getCertImgListServiceV2?ServiceKey=0Df2pGeb6Ehc7VdL524s6NAOfK8WqAgRUmGkUNAhgesGIsAY7fhk8uWvUClwptp1l3SJ946LgKLnf%2B8%2B4CQwNQ%3D%3D&returnType=json&prdlstNm=${h}&numOfRows=100`,_=await S(p,R.EXTERNAL),{items:x}=_.body;if(console.log(x),!x)return N.error("조회된 제품이 존재하지 않습니다."),n("");o(x),N.success("제품조회에 성공 하였습니다."),i(!1),n("")},y=t.useCallback(h=>{const p=a==null?void 0:a.find(x=>x.item.prdlstReportNo===h);if(!p)return;const _=p.item;g(_)},[a]);function b(){C(s),sessionStorage.setItem("currentHccp","0")}function H(h){h.preventDefault();const p=h.currentTarget.firstChild;if(!(p instanceof HTMLInputElement))return;const _=p.value;n(_),b()}return t.useEffect(()=>{document.title="HACCP 제품 정보조회 | FoodPicker"},[]),t.useEffect(()=>{d&&y(d)},[d,y]),e.jsxs("section",{className:r.Haccp,ref:j,children:[e.jsx("h2",{style:{textAlign:"center",margin:"6rem 0"},className:r.haccp_page_title,children:e.jsx("p",{children:"HACCP제품 정보조회"})}),e.jsx(w,{path:"/haccp",mainName:"조회서비스",subName:"HACCP제품조회"}),e.jsxs("div",{className:r.haccp_inner_container,children:[e.jsx(ee,{loading:c,search:b,searchAction:H,productName:s}),e.jsx(se,{}),e.jsx("br",{})]}),e.jsxs(t.Suspense,{fallback:e.jsx("h2",{children:"결과를 가져오는 중입니다."}),children:[e.jsx(J,{items:a,setModal:u,setProductId:m}),e.jsx(U,{filterItem:f,setModal:u,modal:l})]})]})}export{ne as default};
